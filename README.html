<h1 id="accelerating-encrypted-deduplication-via-sgx">Accelerating Encrypted Deduplication via SGX</h1>
<h2 id="introduction">Introduction</h2>
<p>Encrypted deduplication preserves the deduplication effectiveness on encrypted data and is attractive for outsourced storage. However, existing encrypted deduplication approaches build on expensive cryptographic primitives that incur substantial performance slowdown. We present SGXDedup, which leverages Intel SGX to speed up encrypted deduplication based on server-aided message-locked encryption (MLE) while preserving security via SGX. SGXDedup implements a suite of secure interfaces to execute MLE key generation and proof-of-ownership operations in SGX enclaves. It also proposes various designs to support secure and efficient enclave operations. Evaluation of synthetic and real-world workloads shows that SGXDedup achieves significant speedups and maintains high bandwidth and storage savings.</p>
<h2 id="publication">Publication</h2>
<ul>
<li>Yanjing Ren, Jingwei Li, Zuoru Yang, Patrick P. C. Lee, and Xiaosong Zhang. Accelerating Encrypted Deduplication via SGX. In Proc of USENIX Annual Technical Conference (ATC’21), July 2021.</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<p>SGXDedup is tested on a machine that equips with a Gigabyte B250M-D3H motherboard and an Intel i5-7400 CPU and runs Ubuntu 18.04.5 LTS.</p>
<p>Before running SGXDedup, check if your machine supports SGX. If there is an option as <code>SGX</code> or <code>Intel Software Guard Extensions</code> in BIOS, then enable the option; otherwise your machine does not support SGX. We strongly recommend to find the SGX-supported device in the <a href="https://github.com/ayeks/SGX-hardware">SGX hardware list</a>.</p>
<h3 id="registration">Registration</h3>
<p>SGXDedup uses EPID-based remote attestation, and you need to register at the <a href="https://api.portal.trustedservices.intel.com/EPID-attestation">EPID attestation page</a>. Then, you can find your SPID and the corresponding subscription keys (both the primary and the secondary keys) at the <a href="https://api.portal.trustedservices.intel.com/products">products page</a>. Our test uses the <code>DEV Intel® Software Guard Extensions Attestation Service (Unlinkable)</code> product.</p>
<h3 id="dependencies">Dependencies</h3>
<p>SGXDedup depends on the following packages that need to be installed manually or by package management tools.</p>
<ol type="1">
<li>Intel® Software Guard Extensions (Intel® SGX) driver version 2.6.0_4f5bb53 <a href="https://download.01.org/intel-sgx/sgx-linux/2.7/distro/ubuntu18.04-server/sgx_linux_x64_driver_2.6.0_4f5bb63.bin">Download</a></li>
<li>Intel® SGX platform software (Intel® SGX PSW) version 2.7.100.4 <a href="https://download.01.org/intel-sgx/sgx-linux/2.7/distro/ubuntu18.04-server/libsgx-enclave-common_2.7.100.4-bionic1_amd64.deb">Download</a></li>
<li>Intel® SGX SDK version 2.7.100.4 <a href="https://download.01.org/intel-sgx/sgx-linux/2.7/distro/ubuntu18.04-server/sgx_linux_x64_sdk_2.7.100.4.bin">Download</a></li>
<li>Intel® SGX SSL version lin_2.5_1.1.1d <a href="https://github.com/intel/intel-sgx-ssl/archive/refs/tags/lin_2.5_1.1.1d.zip">Download</a></li>
<li>OpenSSL version 1.1.1d <a href="https://www.openssl.org/source/old/1.1.1/openssl-1.1.1d.tar.gz">Donwload</a></li>
<li>The cmake module used to compile the SGX program in the cmake system: <a href="https://github.com/xzhangxa/SGX-CMake/blob/master/cmake/FindSGX.cmake">Download</a></li>
<li>libssl-dev (For SGXDedup encryption algorithm)</li>
<li>libcurl4-openssl-dev (Required by SGX packages)</li>
<li>libprotobuf-dev (Required by SGX packages)</li>
<li>libboost-all-dev (For SGXDedup multithreading, message transmission, etc.)</li>
<li>libleveldb-dev (For SGXDedup deduplication index based on LevelDB)</li>
<li>libsnappy-dev (Required by LevelDB)</li>
<li>build-essential (Basic program compilation environment)</li>
<li>cmake (CMake automated build framework)</li>
<li>wget (System components used for remote attestation requests)</li>
</ol>
<p>We now provide a one-step script to automatically install and configure the dependencies. We have tested the script on Ubuntu 18.04 LTS.</p>
<pre class="shell"><code>chmod +x Scripts/environmentInstall.sh
sudo ./Scripts/environmentInstall.sh</code></pre>
<p>Restart is required after the installation is finished. Then, check whether <code>isgx</code> is in <code>/dev</code>. If it is not in the directory (i.e., SGX driver is not successfully installed), reinstall SGX driver manually and restart the machine until <code>isgx</code> is in <code>/dev</code>.</p>
<h2 id="sgxdedup-running-guide">SGXDedup Running Guide</h2>
<h3 id="configuration">Configuration</h3>
<p>SGXDedup is configured based on JSON. You can change its configuration without rebuilding. We show the default configuration (<code>./config.json</code>) of SGXDedup as follows.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">    <span class="dt">&quot;ChunkerConfig&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">        <span class="dt">&quot;_chunkingType&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span> <span class="er">//</span> <span class="er">0</span><span class="fu">:</span> <span class="er">fixed</span> <span class="er">size</span> <span class="er">chunking;</span> <span class="dv">1</span><span class="er">:</span> <span class="er">variable</span> <span class="er">size</span> <span class="er">chunking;</span> <span class="dv">2</span><span class="er">:</span> <span class="er">FSL</span> <span class="er">dataset</span> <span class="er">hash</span> <span class="er">list;</span> <span class="dv">3</span><span class="er">:</span> <span class="er">MS</span> <span class="er">dataset</span> <span class="er">hash</span> <span class="er">list</span></a>
<a class="sourceLine" id="cb2-4" title="4">        <span class="st">&quot;_minChunkSize&quot;</span><span class="er">:</span> <span class="dv">4096</span><span class="fu">,</span> <span class="er">//</span> <span class="er">The</span> <span class="er">smallest</span> <span class="er">chunk</span> <span class="er">size</span> <span class="er">in</span> <span class="er">variable</span> <span class="er">size</span> <span class="er">chunking</span><span class="fu">,</span> <span class="er">Uint</span><span class="fu">:</span> <span class="er">Byte</span> <span class="er">(Maximum</span> <span class="er">size</span> <span class="dv">16</span><span class="er">KB)</span></a>
<a class="sourceLine" id="cb2-5" title="5">        <span class="st">&quot;_avgChunkSize&quot;</span><span class="er">:</span> <span class="dv">8192</span><span class="fu">,</span> <span class="er">//</span> <span class="er">The</span> <span class="er">average</span> <span class="er">chunk</span> <span class="er">size</span> <span class="er">in</span> <span class="er">variable</span> <span class="er">size</span> <span class="er">chunking</span> <span class="er">and</span> <span class="er">chunk</span> <span class="er">size</span> <span class="er">in</span> <span class="er">fixed</span> <span class="er">size</span> <span class="er">chunking</span><span class="fu">,</span> <span class="er">Uint</span><span class="fu">:</span> <span class="er">Byte</span> <span class="er">(Maximum</span> <span class="er">size</span> <span class="dv">16</span><span class="er">KB)</span></a>
<a class="sourceLine" id="cb2-6" title="6">        <span class="st">&quot;_maxChunkSize&quot;</span><span class="er">:</span> <span class="dv">16384</span><span class="fu">,</span> <span class="er">//</span> <span class="er">The</span> <span class="er">biggest</span> <span class="er">chunk</span> <span class="er">size</span> <span class="er">in</span> <span class="er">variable</span> <span class="er">size</span> <span class="er">chunking</span><span class="fu">,</span> <span class="er">Uint</span><span class="fu">:</span> <span class="er">Byte</span> <span class="er">(Maximum</span> <span class="er">size</span> <span class="dv">16</span><span class="er">KB)</span></a>
<a class="sourceLine" id="cb2-7" title="7">        <span class="st">&quot;_slidingWinSize&quot;</span><span class="er">:</span> <span class="dv">256</span><span class="fu">,</span> <span class="er">//</span> <span class="er">The</span> <span class="er">sliding</span> <span class="er">window</span> <span class="er">size</span> <span class="er">in</span> <span class="er">variable</span> <span class="er">size</span> <span class="er">chunking</span><span class="fu">,</span> <span class="er">Uint</span><span class="fu">:</span> <span class="er">MB</span></a>
<a class="sourceLine" id="cb2-8" title="8">        <span class="st">&quot;_ReadSize&quot;</span><span class="er">:</span> <span class="dv">256</span> <span class="er">//</span> <span class="er">System</span> <span class="er">read</span> <span class="er">input</span> <span class="er">file</span> <span class="er">size</span> <span class="er">every</span> <span class="er">I/O</span> <span class="er">operation</span><span class="fu">,</span> <span class="er">Uint</span><span class="fu">:</span> <span class="er">MB</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="fu">},</span></a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="dt">&quot;KeyServerConfig&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-11" title="11">        <span class="dt">&quot;_keyBatchSize&quot;</span><span class="fu">:</span> <span class="dv">4096</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Maximum</span> <span class="er">number</span> <span class="er">of</span> <span class="er">keys</span> <span class="er">obtained</span> <span class="er">per</span> <span class="er">communication</span></a>
<a class="sourceLine" id="cb2-12" title="12">        <span class="dt">&quot;_keyEnclaveThreadNumber&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Maximum</span> <span class="er">thread</span> <span class="er">number</span> <span class="er">for</span> <span class="er">key</span> <span class="er">enclave</span></a>
<a class="sourceLine" id="cb2-13" title="13">        <span class="dt">&quot;_keyServerRArequestPort&quot;</span><span class="fu">:</span> <span class="dv">1559</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Key</span> <span class="er">server</span> <span class="er">host</span> <span class="er">port</span> <span class="er">for</span> <span class="er">receive</span> <span class="er">key</span> <span class="er">enclave</span> <span class="er">remote</span> <span class="er">attestation</span> <span class="er">request</span> </a>
<a class="sourceLine" id="cb2-14" title="14">        <span class="dt">&quot;_keyServerIP&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb2-15" title="15">            <span class="st">&quot;127.0.0.1&quot;</span></a>
<a class="sourceLine" id="cb2-16" title="16">        <span class="ot">]</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Key</span> <span class="er">server</span> <span class="er">host</span> <span class="er">IP</span> <span class="er">()</span></a>
<a class="sourceLine" id="cb2-17" title="17">        <span class="dt">&quot;_keyServerPort&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb2-18" title="18">            <span class="dv">6666</span></a>
<a class="sourceLine" id="cb2-19" title="19">        <span class="ot">]</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Key</span> <span class="er">server</span> <span class="er">host</span> <span class="er">port</span> <span class="er">for</span> <span class="er">client</span> <span class="er">key</span> <span class="er">generation</span></a>
<a class="sourceLine" id="cb2-20" title="20">        <span class="dt">&quot;_keyRegressionMaxTimes&quot;</span><span class="fu">:</span> <span class="dv">1048576</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Key</span> <span class="er">regression</span> <span class="er">maximum</span> <span class="er">numbers</span> <span class="er">`n`</span></a>
<a class="sourceLine" id="cb2-21" title="21">        <span class="dt">&quot;_keyRegressionIntervals&quot;</span><span class="fu">:</span> <span class="dv">25920000</span> <span class="er">//</span> <span class="er">Time</span> <span class="er">interval</span> <span class="er">for</span> <span class="er">key</span> <span class="er">regression</span> <span class="er">(Unit:</span> <span class="er">seconds)</span><span class="fu">,</span> <span class="er">used</span> <span class="er">for</span> <span class="er">key</span> <span class="er">enclave.</span> <span class="er">Should</span> <span class="er">be</span> <span class="er">consistent</span> <span class="er">with</span> <span class="dt">&quot;server._keyRegressionIntervals&quot;</span></a>
<a class="sourceLine" id="cb2-22" title="22">    <span class="fu">},</span></a>
<a class="sourceLine" id="cb2-23" title="23">    <span class="dt">&quot;SPConfig&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-24" title="24">        <span class="dt">&quot;_storageServerIScriptsP&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb2-25" title="25">            <span class="st">&quot;127.0.0.1&quot;</span></a>
<a class="sourceLine" id="cb2-26" title="26">        <span class="ot">]</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Storage</span> <span class="er">server</span> <span class="er">host</span> <span class="er">IP</span></a>
<a class="sourceLine" id="cb2-27" title="27">        <span class="dt">&quot;_storageServerPort&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb2-28" title="28">            <span class="dv">6668</span></a>
<a class="sourceLine" id="cb2-29" title="29">        <span class="ot">]</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Storage</span> <span class="er">server</span> <span class="er">host</span> <span class="er">port</span> <span class="er">for</span> <span class="er">client</span> <span class="er">upload</span> <span class="er">or</span> <span class="er">download</span> <span class="er">files</span></a>
<a class="sourceLine" id="cb2-30" title="30">        <span class="dt">&quot;_maxContainerSize&quot;</span><span class="fu">:</span> <span class="dv">8388608</span> <span class="er">//</span> <span class="er">Maximum</span> <span class="er">space</span> <span class="er">for</span> <span class="er">one-time</span> <span class="er">persistent</span> <span class="er">chunk</span> <span class="er">storage</span><span class="fu">,</span> <span class="er">Uint</span><span class="fu">:</span> <span class="er">Byte</span> <span class="er">(Maximum</span> <span class="er">size</span> <span class="dv">8</span><span class="er">MB)</span></a>
<a class="sourceLine" id="cb2-31" title="31">    <span class="fu">},</span></a>
<a class="sourceLine" id="cb2-32" title="32">    <span class="dt">&quot;pow&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-33" title="33">        <span class="dt">&quot;_quoteType&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Enclave</span> <span class="er">quote</span> <span class="er">type</span><span class="fu">,</span> <span class="er">do</span> <span class="er">not</span> <span class="er">modify</span> <span class="er">it</span> </a>
<a class="sourceLine" id="cb2-34" title="34">        <span class="dt">&quot;_iasVersion&quot;</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Enclave</span> <span class="er">IAS</span> <span class="er">version</span><span class="fu">,</span> <span class="er">do</span> <span class="er">not</span> <span class="er">modify</span> <span class="er">it</span> </a>
<a class="sourceLine" id="cb2-35" title="35">        <span class="dt">&quot;_iasServerType&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Server</span> <span class="er">IAS</span> <span class="er">version</span><span class="fu">,</span> <span class="er">do</span> <span class="er">not</span> <span class="er">modify</span> <span class="er">it</span></a>
<a class="sourceLine" id="cb2-36" title="36">        <span class="dt">&quot;_batchSize&quot;</span><span class="fu">:</span> <span class="dv">4096</span><span class="fu">,</span> <span class="er">//</span> <span class="er">POW</span> <span class="er">enclave</span> <span class="er">batch</span> <span class="er">size</span> <span class="er">(Unit</span><span class="fu">:</span> <span class="er">chunks)</span></a>
<a class="sourceLine" id="cb2-37" title="37">        <span class="st">&quot;_ServerPort&quot;</span><span class="er">:</span> <span class="dv">6669</span><span class="fu">,</span> <span class="er">//</span> <span class="er">The</span> <span class="er">port</span> <span class="er">on</span> <span class="er">storage</span> <span class="er">server</span> <span class="er">for</span> <span class="er">remote</span> <span class="er">attestation</span></a>
<a class="sourceLine" id="cb2-38" title="38">        <span class="dt">&quot;_enclave_name&quot;</span><span class="fu">:</span> <span class="st">&quot;pow_enclave.signed.so&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">The</span> <span class="er">enclave</span> <span class="er">library</span> <span class="er">name</span> <span class="er">to</span> <span class="er">create</span> <span class="er">the</span> <span class="er">target</span> <span class="er">enclave</span></a>
<a class="sourceLine" id="cb2-39" title="39">        <span class="dt">&quot;_SPID&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">SPID</span> <span class="er">for</span> <span class="er">remote</span> <span class="er">attseation</span> <span class="er">service</span></a>
<a class="sourceLine" id="cb2-40" title="40">        <span class="dt">&quot;_PriSubscriptionKey&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">Intel</span> <span class="er">remote</span> <span class="er">attestation</span> <span class="er">service</span> <span class="er">primary</span> <span class="er">subscription</span> <span class="er">key</span></a>
<a class="sourceLine" id="cb2-41" title="41">        <span class="dt">&quot;_SecSubscriptionKey&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">Intel</span> <span class="er">remote</span> <span class="er">attestation</span> <span class="er">service</span> <span class="er">secondary</span> <span class="er">subscription</span> <span class="er">key</span></a>
<a class="sourceLine" id="cb2-42" title="42">    <span class="fu">},</span></a>
<a class="sourceLine" id="cb2-43" title="43">    <span class="dt">&quot;km&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-44" title="44">        <span class="dt">&quot;_quoteType&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Enclave</span> <span class="er">quote</span> <span class="er">type</span><span class="fu">,</span> <span class="er">do</span> <span class="er">not</span> <span class="er">modify</span> <span class="er">it</span> </a>
<a class="sourceLine" id="cb2-45" title="45">        <span class="dt">&quot;_iasVersion&quot;</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Enclave</span> <span class="er">IAS</span> <span class="er">version</span><span class="fu">,</span> <span class="er">do</span> <span class="er">not</span> <span class="er">modify</span> <span class="er">it</span> </a>
<a class="sourceLine" id="cb2-46" title="46">        <span class="dt">&quot;_iasServerType&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Server</span> <span class="er">IAS</span> <span class="er">version</span><span class="fu">,</span> <span class="er">do</span> <span class="er">not</span> <span class="er">modify</span> <span class="er">it</span></a>
<a class="sourceLine" id="cb2-47" title="47">        <span class="dt">&quot;_ServerPort&quot;</span><span class="fu">:</span> <span class="dv">6676</span><span class="fu">,</span> <span class="er">//</span> <span class="er">The</span> <span class="er">port</span> <span class="er">on</span> <span class="er">storage</span> <span class="er">server</span> <span class="er">for</span> <span class="er">remote</span> <span class="er">attestation</span></a>
<a class="sourceLine" id="cb2-48" title="48">        <span class="dt">&quot;_enclave_name&quot;</span><span class="fu">:</span> <span class="st">&quot;km_enclave.signed.so&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">The</span> <span class="er">enclave</span> <span class="er">library</span> <span class="er">name</span> <span class="er">to</span> <span class="er">create</span> <span class="er">the</span> <span class="er">target</span> <span class="er">enclave</span></a>
<a class="sourceLine" id="cb2-49" title="49">        <span class="dt">&quot;_SPID&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">SPID</span> <span class="er">for</span> <span class="er">remote</span> <span class="er">attseation</span> <span class="er">service</span></a>
<a class="sourceLine" id="cb2-50" title="50">        <span class="dt">&quot;_PriSubscriptionKey&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">Intel</span> <span class="er">remote</span> <span class="er">attestation</span> <span class="er">service</span> <span class="er">primary</span> <span class="er">subscription</span> <span class="er">key</span></a>
<a class="sourceLine" id="cb2-51" title="51">        <span class="dt">&quot;_SecSubscriptionKey&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">Intel</span> <span class="er">remote</span> <span class="er">attestation</span> <span class="er">service</span> <span class="er">secondary</span> <span class="er">subscription</span> <span class="er">key</span></a>
<a class="sourceLine" id="cb2-52" title="52">    <span class="fu">},</span></a>
<a class="sourceLine" id="cb2-53" title="53">    <span class="dt">&quot;server&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-54" title="54">        <span class="dt">&quot;_RecipeRootPath&quot;</span><span class="fu">:</span> <span class="st">&quot;Recipes/&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Path</span> <span class="er">to</span> <span class="er">the</span> <span class="er">file</span> <span class="er">recipe</span> <span class="er">storage</span> <span class="er">directory</span></a>
<a class="sourceLine" id="cb2-55" title="55">        <span class="dt">&quot;_containerRootPath&quot;</span><span class="fu">:</span> <span class="st">&quot;Containers/&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Path</span> <span class="er">to</span> <span class="er">the</span> <span class="er">unique</span> <span class="er">chunk</span> <span class="er">storage</span> <span class="er">directory</span></a>
<a class="sourceLine" id="cb2-56" title="56">        <span class="dt">&quot;_fp2ChunkDBName&quot;</span><span class="fu">:</span> <span class="st">&quot;db1&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Path</span> <span class="er">to</span> <span class="er">the</span> <span class="er">chunk</span> <span class="er">database</span> <span class="er">directory</span></a>
<a class="sourceLine" id="cb2-57" title="57">        <span class="dt">&quot;_fp2MetaDBame&quot;</span><span class="fu">:</span> <span class="st">&quot;db2&quot;</span> <span class="er">//</span> <span class="er">Path</span> <span class="er">to</span> <span class="er">the</span> <span class="er">file</span> <span class="er">recipe</span> <span class="er">database</span> <span class="er">directory</span></a>
<a class="sourceLine" id="cb2-58" title="58">        <span class="st">&quot;_raSessionKeylifeSpan&quot;</span><span class="er">:</span> <span class="dv">259200000</span> <span class="er">//</span> <span class="er">Time</span> <span class="er">interval</span> <span class="er">for</span> <span class="er">key</span> <span class="er">regression</span> <span class="er">(Unit:</span> <span class="er">seconds)</span><span class="fu">,</span> <span class="er">used</span> <span class="er">for</span> <span class="er">storage</span> <span class="er">server.</span> <span class="er">Should</span> <span class="er">be</span> <span class="er">consistent</span> <span class="er">with</span> <span class="dt">&quot;KeyServerConfig._keyRegressionIntervals&quot;</span></a>
<a class="sourceLine" id="cb2-59" title="59">    <span class="fu">},</span></a>
<a class="sourceLine" id="cb2-60" title="60">    <span class="dt">&quot;client&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-61" title="61">        <span class="dt">&quot;_clientID&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Current</span> <span class="er">client</span> <span class="er">ID</span> </a>
<a class="sourceLine" id="cb2-62" title="62">        <span class="dt">&quot;_sendChunkBatchSize&quot;</span><span class="fu">:</span> <span class="dv">1000</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Maximum</span> <span class="er">number</span> <span class="er">of</span> <span class="er">chunks</span> <span class="er">sent</span> <span class="er">per</span> <span class="er">communication</span></a>
<a class="sourceLine" id="cb2-63" title="63">        <span class="dt">&quot;_sendRecipeBatchSize&quot;</span><span class="fu">:</span> <span class="dv">100000</span> <span class="er">//</span> <span class="er">Maximum</span> <span class="er">number</span> <span class="er">of</span> <span class="er">file</span> <span class="er">recipe</span> <span class="er">entry</span> <span class="er">sent</span> <span class="er">per</span> <span class="er">communication</span></a>
<a class="sourceLine" id="cb2-64" title="64">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb2-65" title="65"><span class="fu">}</span></a></code></pre></div>
<p>Before starting, you need to fill the SPID and subscription keys in <code>./config.json</code> based on your registration information in Intel.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb3-1" title="1"><span class="er">...</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="er">&quot;pow&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="er">...</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="dt">&quot;_SPID&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">SPID</span> <span class="er">for</span> <span class="er">remote</span> <span class="er">attseation</span> <span class="er">service</span></a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="dt">&quot;_PriSubscriptionKey&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">Intel</span> <span class="er">remote</span> <span class="er">attestation</span> <span class="er">service</span> <span class="er">primary</span> <span class="er">subscription</span> <span class="er">key</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="dt">&quot;_SecSubscriptionKey&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">Intel</span> <span class="er">remote</span> <span class="er">attestation</span> <span class="er">service</span> <span class="er">secondary</span> <span class="er">subscription</span> <span class="er">key</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="fu">}</span><span class="er">,</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="er">&quot;km&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="er">...</span></a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="dt">&quot;_SPID&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">SPID</span> <span class="er">for</span> <span class="er">remote</span> <span class="er">attseation</span> <span class="er">service</span></a>
<a class="sourceLine" id="cb3-11" title="11">    <span class="dt">&quot;_PriSubscriptionKey&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">Intel</span> <span class="er">remote</span> <span class="er">attestation</span> <span class="er">service</span> <span class="er">primary</span> <span class="er">subscription</span> <span class="er">key</span></a>
<a class="sourceLine" id="cb3-12" title="12">    <span class="dt">&quot;_SecSubscriptionKey&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span> <span class="er">//</span> <span class="er">Your</span> <span class="er">Intel</span> <span class="er">remote</span> <span class="er">attestation</span> <span class="er">service</span> <span class="er">secondary</span> <span class="er">subscription</span> <span class="er">key</span></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="fu">}</span><span class="er">,</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="er">...</span></a></code></pre></div>
<h3 id="build">Build</h3>
<p>Compile SGXDedup as follows.</p>
<pre class="shell"><code>mkdir -p bin &amp;&amp; mkdir -p build &amp;&amp; mkdir -p lib &amp;&amp; cd build
cmake -DCMAKE_BUILD_TYPE=Release .. &amp;&amp; make

cd ..
cp lib/*.a bin/
cp ./lib/pow_enclave.signed.so ./bin
cp ./lib/km_enclave.signed.so ./bin
cp config.json bin/
cp -r key/ bin/
mkdir -p bin/Containers &amp;&amp; mkdir -p bin/Recipes</code></pre>
<p>Alternatively, we provide a script for a quick build and clean-up, and you can use it.</p>
<pre class="shell"><code>chmod +x ./Scripts/*.sh
# Build SGXDedup in release mode
./Scripts/buildReleaseMode.sh
# Build SGXDedup in debug mode
./Scripts/buildDebugMode.sh
# Clean up build result
./Scripts/cleanBuild.sh</code></pre>
<h3 id="usage">Usage</h3>
<p>You can test SGXDedup in a single machine, and connect the key manager, server (e.g., the cloud in the ATC paper), and client instances via the local loopback interface.</p>
<pre class="shell"><code># start cloud
./bin/server-sgx

# start key manager
./bin/keymanager-sgx</code></pre>
<p>Since the key enclave needs to be attested by the cloud before usage, you need to start the cloud (<code>server-sgx</code>) first, then start the key manager (<code>keymanager-sgx</code>), and wait for the message <code>KeyServer : keyServer session key update done</code> that indicates a successful attestation.</p>
<p>SGXDedup automatically verifies the PoW enclave by remote attestation in the first startup of the client, and by unsealing (Section 3.2 in the ATC paper) in the following startups. SGXDedup provides store and restores interfaces to clients.</p>
<pre class="shell"><code># store file
./bin/client-sgx -s file

# restore file
./bin/client-sgx -r file</code></pre>
<p>Note that we do not provide any commandline interface for renewing blinded key. Instead, you can configure <code>KeyServerConfig._keyRegressionIntervals</code> and <code>server._raSessionKeylifeSpan</code> (in the unit of a second) in <code>config.json</code> to set the time periods for key renewing cycle in the key manager and the cloud, respectively. Also, you can configure <code>_keyRegressionMaxTimes</code> to control the maximum number of key regression (2^20 by default).</p>
